#

init
set workers to 0
set interval to 10
set serial to false
open

# test: conveyor is not set by default
show storages
show conveyor

# test: insert (main only)
insert 0 x
show storages

# test: insert (more storages wo conveyor)
create storage hot
create storage cold
insert 0 y
insert 30 y
show storages

# test: alter conveyor parsing
alter
alter conveyor
alter conveyor abc
alter conveyor set
alter conveyor set 123

# test: alter conveyor set
alter conveyor set hot
show conveyor

# test: insert (primary changed)
insert 40 z
show storages

# test: select
select

# test: drop storage (with conveyor dependency)
drop storage hot

# test: alter conveyor reset
alter conveyor reset
show conveyor

# test: drop storage #2
drop storage hot
drop partition 40
drop storage hot
show storages

# test: insert (primary changed)
insert 40 v
show storages

# test: alter conveyor set (storage does not exists)
alter conveyor set undef

# test: alter conveyor set (hot swap)
create storage hot
alter conveyor set hot
show conveyor

show storages
insert 50

create storage hot_swap
alter conveyor set hot_swap
show conveyor
show storages

insert 60
show storages

# test: select
select

# test: alter conveyor set capacity (chain)
move partition 60 into hot
alter conveyor reset
drop storage hot_swap

show storages

alter conveyor set hot (capacity 2), cold
show conveyor

# test: alter conveyor set capacity (both)
alter conveyor set hot (capacity 2), cold (capacity 0)
show conveyor

close
