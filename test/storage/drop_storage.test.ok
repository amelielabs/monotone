init
set workers to 0
set workers_upload to 0
set interval to 10
set serial to false
set uuid to '00000000-0000-0000-0000-000000000000'
set sync to false
open
# test: drop storage parsing
drop
error: DROP 'STORAGE|PARTITION|PARTITIONS' expected
drop storage
error: DROP STORAGE 'name' expected
drop storage if
error: IF 'EXISTS' expected
drop storage if 123
error: IF 'EXISTS' expected
drop storage if not
error: IF 'EXISTS' expected
drop storage if exists
error: DROP STORAGE 'name' expected
drop storage if exists 123
error: DROP STORAGE 'name' expected
drop storage 123
error: DROP STORAGE 'name' expected
# test: drop storage
create storage test
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 0,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "test": {
    "config": {
      "uuid": "(filtered)",
      "name": "test",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 0,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  }
}
drop storage test
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 0,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  }
}
# test: drop storage (not exists)
drop storage test
error: storage 'test': not exists
# test: drop storage if exists
drop storage if exists test
# test: drop storage main
drop storage main
error: storage 'main': main storage cannot be dropped
# test: create storage (with partition)
create storage test
insert 0
move partition 0 into test
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 0,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "test": {
    "config": {
      "uuid": "(filtered)",
      "name": "test",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 0,
      "max": 9,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 1,
      "events": 1,
      "events_heap": 0,
      "size": 223,
      "size_uncompressed": 223,
      "size_heap": 0
    }
  }
}
show partitions debug
[{
  "min": 0,
  "max": 9,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 223,
  "size_uncompressed": 223,
  "size_heap": 0,
  "created": "(filtered)",
  "refreshed": "(filtered)",
  "refreshes": 1,
  "on_storage": true,
  "on_cloud": false,
  "storage": "test",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 223,
    "size_total_origin": 223,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 1,
    "compression": 0,
    "encryption": 0
  }
}]
# test: drop storage (with partition)
drop storage test
error: storage 'test': has partitions
drop partition 0
drop storage test
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 0,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  }
}
close
