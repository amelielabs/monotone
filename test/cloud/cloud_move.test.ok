init
set workers to 0
set interval to 10
set serial to false
set uuid to '00000000-0000-0000-0000-000000000000'
open
# test: create partition
insert 0
insert 1
insert 2
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "sync": true,
      "crc": false,
      "compression": "",
      "refresh_wm": 41943040,
      "region_size": 131072
    },
    "stats": {
      "min": 0,
      "max": 10,
      "partitions": 1,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 3,
      "events_heap": 3,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 2097152
    }
  }
}
select
[0]
[1]
[2]
(eof)
# test: create cloud storage
create cloud mock (type 'mock')
show clouds
{
  "mock": {
    "name": "mock",
    "type": "mock",
    "login": "",
    "password": "(secret)",
    "url": "",
    "debug": false
  }
}
create storage test (cloud 'mock', sync false, compression 'zstd')
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "sync": true,
      "crc": false,
      "compression": "",
      "refresh_wm": 41943040,
      "region_size": 131072
    },
    "stats": {
      "min": 0,
      "max": 10,
      "partitions": 1,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 3,
      "events_heap": 3,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 2097152
    }
  },
  "test": {
    "config": {
      "uuid": "(filtered)",
      "name": "test",
      "path": "",
      "cloud": "mock",
      "sync": false,
      "crc": false,
      "compression": "zstd",
      "refresh_wm": 41943040,
      "region_size": 131072
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  }
}
# test: move to cloud
move partition 0 into test
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "sync": true,
      "crc": false,
      "compression": "",
      "refresh_wm": 41943040,
      "region_size": 131072
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "test": {
    "config": {
      "uuid": "(filtered)",
      "name": "test",
      "path": "",
      "cloud": "mock",
      "sync": false,
      "crc": false,
      "compression": "zstd",
      "refresh_wm": 41943040,
      "region_size": 131072
    },
    "stats": {
      "min": 0,
      "max": 10,
      "partitions": 1,
      "partitions_local": 0,
      "partitions_cloud": 1,
      "regions": 1,
      "events": 3,
      "events_heap": 0,
      "size": 194,
      "size_uncompressed": 234,
      "size_heap": 0
    }
  }
}
show partitions debug
[{
  "min": 0,
  "max": 10,
  "created": "(filtered)",
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 194,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": false,
  "on_cloud": true,
  "storage": "test",
  "index": {
    "size": 159,
    "size_regions": 35,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 3,
    "compression": 1
  }
}]
select
[0]
[1]
[2]
(eof)
# test: move from cloud
move partition 0 into main
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "sync": true,
      "crc": false,
      "compression": "",
      "refresh_wm": 41943040,
      "region_size": 131072
    },
    "stats": {
      "min": 0,
      "max": 10,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 1,
      "events": 3,
      "events_heap": 0,
      "size": 234,
      "size_uncompressed": 234,
      "size_heap": 0
    }
  },
  "test": {
    "config": {
      "uuid": "(filtered)",
      "name": "test",
      "path": "",
      "cloud": "mock",
      "sync": false,
      "crc": false,
      "compression": "zstd",
      "refresh_wm": 41943040,
      "region_size": 131072
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  }
}
show partitions debug
[{
  "min": 0,
  "max": 10,
  "created": "(filtered)",
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 234,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 75,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 3,
    "compression": 0
  }
}]
select
[0]
[1]
[2]
(eof)
close
