# test: open/close
init
set workers to 0
set interval to 10
set uuid to 'c14fb1d4-d1f7-5bf1-f256-4ad89bc47379'
set serial to false
open
files
wal
main
config.json
log
close
# test: open
init
set workers to 0
set interval to 10
open
show all
version                         0.0
uuid                            c14fb1d4-d1f7-5bf1-f256-4ad89bc47379
online                          true
directory                       _output
log_enable                      true
log_to_file                     true
log_to_stdout                   false
serial                          false
interval                        10
workers                         0
wal_enable                      true
wal_rotate_wm                   104857600
wal_sync_on_rotate              true
wal_sync_on_write               false
ssn                             0
lsn                             0
psn                             0
events_written                  0
events_written_bytes            0
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
files
wal
main
config.json
log
# test: create storage
create storage test (sync false)
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
test
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                false
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: close/open
close
init
open
# test: ensure storage exists
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
test
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                false
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: alter storage
alter storage test set (compression 'zstd')
# test: close/open
close
init
open
# test: validate storage settings
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
test
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                false
  crc                 false
  compression         zstd
  refresh_wm          41943040
  region_size         131072
# test: drop storage
drop storage test
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: close/open
close
init
open
# test: ensure storage does not exists
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: create cloud
create cloud mock (type 'mock')
show clouds
mock
  type  'mock'
  login ''
  url   ''
# test: close/open
close
init
open
# test: ensure cloud exists
show clouds
mock
  type  'mock'
  login ''
  url   ''
# test: alter cloud
alter cloud mock set (url 'localhost')
# test: close/open
close
init
open
# test: validate cloud settings
show clouds
mock
  type  'mock'
  login ''
  url   'localhost'
# test: alter cloud rename
alter cloud mock rename to mock2
show clouds
mock2
  type  'mock'
  login ''
  url   'localhost'
# test: close/open
close
init
open
# test: validate storage settings
show clouds
mock2
  type  'mock'
  login ''
  url   'localhost'
# test: drop cloud
drop cloud mock2
show clouds
# test: close/open
close
init
open
# test: ensure cloud does not exists
show clouds
# test: create storage with cloud
create cloud mock (type 'mock')
show clouds
mock
  type  'mock'
  login ''
  url   ''
create storage test (cloud 'mock', sync false)
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
test
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               'mock'
  sync                false
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: close/open
close
init
open
# test: ensure storage exists
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
test
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               'mock'
  sync                false
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: drop storage
drop storage test
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: close/open
close
init
open
# test: ensure storage does not exists
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: alter set pipeline
alter pipeline set main (partitions 0)
show pipeline
main (partitions 0)
# test: close/open
close
init
open
# test: ensure pipeline settings remain
show pipeline
main (partitions 0)
show storages
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
close
