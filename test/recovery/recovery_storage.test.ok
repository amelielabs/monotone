init
set workers to 0
set interval to 10
set wal_enable to false
set serial to false
set uuid to '00000000-0000-0000-0000-000000000000'
open
# test: create partition
insert 0
insert 1
insert 2
insert 3
refresh partition 0
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 251,
  "size_uncompressed": 251,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 92,
    "size_regions_origin": 92,
    "regions": 1,
    "events": 4,
    "lsn": 4,
    "compression": 0
  }
}]
files 00000000-0000-0000-0000-000000000000
00000000000000000000
select
[0]
[1]
[2]
[3]
(eof)
# test: close/open
close
init
set workers to 0
set interval to 10
set wal_enable to false
open
files 00000000-0000-0000-0000-000000000000
00000000000000000000
# test: validate partition
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 251,
  "size_uncompressed": 251,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 92,
    "size_regions_origin": 92,
    "regions": 1,
    "events": 4,
    "lsn": 4,
    "compression": 0
  }
}]
select
[0]
[1]
[2]
[3]
(eof)
# test: create partitions
insert 200
insert 201
insert 202
refresh partition 200
insert 300
insert 301
insert 302
refresh partition 300
insert 700
insert 701
insert 702
refresh partition 700
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 251,
  "size_uncompressed": 251,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 92,
    "size_regions_origin": 92,
    "regions": 1,
    "events": 4,
    "lsn": 4,
    "compression": 0
  }
}, {
  "min": 200,
  "max": 210,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 234,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 75,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 7,
    "compression": 0
  }
}, {
  "min": 300,
  "max": 310,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 234,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 75,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 10,
    "compression": 0
  }
}, {
  "min": 700,
  "max": 710,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 234,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 75,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 13,
    "compression": 0
  }
}]
select
[0]
[1]
[2]
[3]
[200]
[201]
[202]
[300]
[301]
[302]
[700]
[701]
[702]
(eof)
# test: close/open
close
init
set workers to 0
set interval to 10
set wal_enable to false
open
files 00000000-0000-0000-0000-000000000000
00000000000000000000
00000000000000000200
00000000000000000300
00000000000000000700
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 251,
  "size_uncompressed": 251,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 92,
    "size_regions_origin": 92,
    "regions": 1,
    "events": 4,
    "lsn": 4,
    "compression": 0
  }
}, {
  "min": 200,
  "max": 210,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 234,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 75,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 7,
    "compression": 0
  }
}, {
  "min": 300,
  "max": 310,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 234,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 75,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 10,
    "compression": 0
  }
}, {
  "min": 700,
  "max": 710,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 234,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 75,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 13,
    "compression": 0
  }
}]
select
[0]
[1]
[2]
[3]
[200]
[201]
[202]
[300]
[301]
[302]
[700]
[701]
[702]
(eof)
# test: update and refresh partitions
insert 300 x
insert 301 x
insert 302 x
refresh partition 300
insert 700 x
delete 701
delete 702
refresh partition 700
# test: close/open
close
init
set workers to 0
set interval to 10
set wal_enable to false
open
files 00000000-0000-0000-0000-000000000000
00000000000000000000
00000000000000000200
00000000000000000300
00000000000000000700
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 251,
  "size_uncompressed": 251,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 92,
    "size_regions_origin": 92,
    "regions": 1,
    "events": 4,
    "lsn": 4,
    "compression": 0
  }
}, {
  "min": 200,
  "max": 210,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 234,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 75,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 7,
    "compression": 0
  }
}, {
  "min": 300,
  "max": 310,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 239,
  "size_uncompressed": 239,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 161,
    "size_regions": 78,
    "size_regions_origin": 78,
    "regions": 1,
    "events": 3,
    "lsn": 16,
    "compression": 0
  }
}, {
  "min": 700,
  "max": 710,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 203,
  "size_uncompressed": 203,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 161,
    "size_regions": 42,
    "size_regions_origin": 42,
    "regions": 1,
    "events": 1,
    "lsn": 19,
    "compression": 0
  }
}]
select
[0]
[1]
[2]
[3]
[200]
[201]
[202]
[300, x]
[301, x]
[302, x]
[700, x]
(eof)
# test: drop partition
drop partition 300
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 251,
  "size_uncompressed": 251,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 92,
    "size_regions_origin": 92,
    "regions": 1,
    "events": 4,
    "lsn": 4,
    "compression": 0
  }
}, {
  "min": 200,
  "max": 210,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 234,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 75,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 7,
    "compression": 0
  }
}, {
  "min": 700,
  "max": 710,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 203,
  "size_uncompressed": 203,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 161,
    "size_regions": 42,
    "size_regions_origin": 42,
    "regions": 1,
    "events": 1,
    "lsn": 19,
    "compression": 0
  }
}]
files 00000000-0000-0000-0000-000000000000
00000000000000000000
00000000000000000200
00000000000000000700
# test: close/open
close
init
set workers to 0
set interval to 10
set wal_enable to false
open
files 00000000-0000-0000-0000-000000000000
00000000000000000000
00000000000000000200
00000000000000000700
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 251,
  "size_uncompressed": 251,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 92,
    "size_regions_origin": 92,
    "regions": 1,
    "events": 4,
    "lsn": 4,
    "compression": 0
  }
}, {
  "min": 200,
  "max": 210,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 234,
  "size_uncompressed": 234,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 159,
    "size_regions": 75,
    "size_regions_origin": 75,
    "regions": 1,
    "events": 3,
    "lsn": 7,
    "compression": 0
  }
}, {
  "min": 700,
  "max": 710,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 203,
  "size_uncompressed": 203,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 161,
    "size_regions": 42,
    "size_regions_origin": 42,
    "regions": 1,
    "events": 1,
    "lsn": 19,
    "compression": 0
  }
}]
select
[0]
[1]
[2]
[3]
[200]
[201]
[202]
[700, x]
(eof)
# test: drop partition
drop partition 0
drop partition 200
drop partition 700
# test: close/open
close
init
set workers to 0
set interval to 10
set wal_enable to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show partitions debug
[]
select
(eof)
# test: create storages
create storage hot (sync false)
create storage cold (sync false)
alter pipeline set hot (partitions 2), cold
# test: close/open
close
init
set workers to 0
set interval to 10
set wal_enable to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate storages
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "sync": true,
      "crc": false,
      "compression": "",
      "refresh_wm": 41943040,
      "region_size": 131072
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "hot": {
    "config": {
      "uuid": "(filtered)",
      "name": "hot",
      "path": "",
      "cloud": "",
      "sync": false,
      "crc": false,
      "compression": "",
      "refresh_wm": 41943040,
      "region_size": 131072
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "cold": {
    "config": {
      "uuid": "(filtered)",
      "name": "cold",
      "path": "",
      "cloud": "",
      "sync": false,
      "crc": false,
      "compression": "",
      "refresh_wm": 41943040,
      "region_size": 131072
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  }
}
show pipeline
[{
  "name": "hot",
  "partitions": 2,
  "size": -1,
  "events": -1,
  "interval": -1
}, {
  "name": "cold",
  "partitions": -1,
  "size": -1,
  "events": -1,
  "interval": -1
}]
# test: create partition #1 (< partitions)
insert 0
refresh partition 0
# test: close/open
close
init
set workers to 0
set interval to 10
set wal_enable to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 200,
  "size_uncompressed": 200,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 159,
    "size_regions": 41,
    "size_regions_origin": 41,
    "regions": 1,
    "events": 1,
    "lsn": 1,
    "compression": 0
  }
}]
select
[0]
(eof)
# test: create partition #2 (= partitions)
insert 10
refresh partition 10
# test: close/open
close
init
set workers to 0
set interval to 10
set wal_enable to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 200,
  "size_uncompressed": 200,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 159,
    "size_regions": 41,
    "size_regions_origin": 41,
    "regions": 1,
    "events": 1,
    "lsn": 1,
    "compression": 0
  }
}, {
  "min": 10,
  "max": 20,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 200,
  "size_uncompressed": 200,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 159,
    "size_regions": 41,
    "size_regions_origin": 41,
    "regions": 1,
    "events": 1,
    "lsn": 2,
    "compression": 0
  }
}]
select
[0]
[10]
(eof)
# test: create partition #3 (> partitions)
insert 20
refresh partition 20
# test: rebalance
rebalance
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 200,
  "size_uncompressed": 200,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "cold",
  "index": {
    "size": 159,
    "size_regions": 41,
    "size_regions_origin": 41,
    "regions": 1,
    "events": 1,
    "lsn": 1,
    "compression": 0
  }
}, {
  "min": 10,
  "max": 20,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 200,
  "size_uncompressed": 200,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 159,
    "size_regions": 41,
    "size_regions_origin": 41,
    "regions": 1,
    "events": 1,
    "lsn": 2,
    "compression": 0
  }
}, {
  "min": 20,
  "max": 30,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 200,
  "size_uncompressed": 200,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 159,
    "size_regions": 41,
    "size_regions_origin": 41,
    "regions": 1,
    "events": 1,
    "lsn": 3,
    "compression": 0
  }
}]
# test: close/open
close
init
set workers to 0
set interval to 10
set wal_enable to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 10,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 200,
  "size_uncompressed": 200,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "cold",
  "index": {
    "size": 159,
    "size_regions": 41,
    "size_regions_origin": 41,
    "regions": 1,
    "events": 1,
    "lsn": 1,
    "compression": 0
  }
}, {
  "min": 10,
  "max": 20,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 200,
  "size_uncompressed": 200,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 159,
    "size_regions": 41,
    "size_regions_origin": 41,
    "regions": 1,
    "events": 1,
    "lsn": 2,
    "compression": 0
  }
}, {
  "min": 20,
  "max": 30,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 200,
  "size_uncompressed": 200,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 159,
    "size_regions": 41,
    "size_regions_origin": 41,
    "regions": 1,
    "events": 1,
    "lsn": 3,
    "compression": 0
  }
}]
select
[0]
[10]
[20]
(eof)
close
