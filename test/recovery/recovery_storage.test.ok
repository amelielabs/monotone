init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
set serial to false
set uuid to '00000000-0000-0000-0000-000000000000'
open
# test: create partition
insert 0
insert 1
insert 2
insert 3
refresh partition 0
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 266,
  "size_uncompressed": 266,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 92,
    "size_regions_origin": 92,
    "size_total": 266,
    "size_total_origin": 266,
    "regions": 1,
    "events": 4,
    "refreshes": 1,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}]
files 00000000-0000-0000-0000-000000000000
00000000000000000000
select
[0]
[1]
[2]
[3]
(eof)
# test: close/open
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
00000000000000000000
# test: validate partition
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 266,
  "size_uncompressed": 266,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 92,
    "size_regions_origin": 92,
    "size_total": 266,
    "size_total_origin": 266,
    "regions": 1,
    "events": 4,
    "refreshes": 1,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}]
select
[0]
[1]
[2]
[3]
(eof)
# test: create partitions
insert 200
insert 201
insert 202
refresh partition 200
insert 300
insert 301
insert 302
refresh partition 300
insert 700
insert 701
insert 702
refresh partition 700
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 266,
  "size_uncompressed": 266,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 92,
    "size_regions_origin": 92,
    "size_total": 266,
    "size_total_origin": 266,
    "regions": 1,
    "events": 4,
    "refreshes": 1,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 200,
  "max": 209,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 249,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 75,
    "size_regions_origin": 75,
    "size_total": 249,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 1,
    "lsn": 7,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 300,
  "max": 309,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 249,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 75,
    "size_regions_origin": 75,
    "size_total": 249,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 1,
    "lsn": 10,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 700,
  "max": 709,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 249,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 75,
    "size_regions_origin": 75,
    "size_total": 249,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 1,
    "lsn": 13,
    "compression": 0,
    "encryption": 0
  }
}]
select
[0]
[1]
[2]
[3]
[200]
[201]
[202]
[300]
[301]
[302]
[700]
[701]
[702]
(eof)
# test: close/open
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
00000000000000000000
00000000000000000200
00000000000000000300
00000000000000000700
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 266,
  "size_uncompressed": 266,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 92,
    "size_regions_origin": 92,
    "size_total": 266,
    "size_total_origin": 266,
    "regions": 1,
    "events": 4,
    "refreshes": 1,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 200,
  "max": 209,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 249,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 75,
    "size_regions_origin": 75,
    "size_total": 249,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 1,
    "lsn": 7,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 300,
  "max": 309,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 249,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 75,
    "size_regions_origin": 75,
    "size_total": 249,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 1,
    "lsn": 10,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 700,
  "max": 709,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 249,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 75,
    "size_regions_origin": 75,
    "size_total": 249,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 1,
    "lsn": 13,
    "compression": 0,
    "encryption": 0
  }
}]
select
[0]
[1]
[2]
[3]
[200]
[201]
[202]
[300]
[301]
[302]
[700]
[701]
[702]
(eof)
# test: update and refresh partitions
insert 300 x
insert 301 x
insert 302 x
refresh partition 300
insert 700 x
delete 701
delete 702
refresh partition 700
# test: close/open
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
00000000000000000000
00000000000000000200
00000000000000000300
00000000000000000700
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 266,
  "size_uncompressed": 266,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 92,
    "size_regions_origin": 92,
    "size_total": 266,
    "size_total_origin": 266,
    "regions": 1,
    "events": 4,
    "refreshes": 1,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 200,
  "max": 209,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 249,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 75,
    "size_regions_origin": 75,
    "size_total": 249,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 1,
    "lsn": 7,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 300,
  "max": 309,
  "created": "(filtered)",
  "refreshes": 2,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 252,
  "size_uncompressed": 252,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 78,
    "size_regions_origin": 78,
    "size_total": 252,
    "size_total_origin": 252,
    "regions": 1,
    "events": 3,
    "refreshes": 2,
    "lsn": 16,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 700,
  "max": 709,
  "created": "(filtered)",
  "refreshes": 2,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 216,
  "size_uncompressed": 216,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 42,
    "size_regions_origin": 42,
    "size_total": 216,
    "size_total_origin": 216,
    "regions": 1,
    "events": 1,
    "refreshes": 2,
    "lsn": 19,
    "compression": 0,
    "encryption": 0
  }
}]
select
[0]
[1]
[2]
[3]
[200]
[201]
[202]
[300, x]
[301, x]
[302, x]
[700, x]
(eof)
# test: drop partition
drop partition 300
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 266,
  "size_uncompressed": 266,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 92,
    "size_regions_origin": 92,
    "size_total": 266,
    "size_total_origin": 266,
    "regions": 1,
    "events": 4,
    "refreshes": 1,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 200,
  "max": 209,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 249,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 75,
    "size_regions_origin": 75,
    "size_total": 249,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 1,
    "lsn": 7,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 700,
  "max": 709,
  "created": "(filtered)",
  "refreshes": 2,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 216,
  "size_uncompressed": 216,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 42,
    "size_regions_origin": 42,
    "size_total": 216,
    "size_total_origin": 216,
    "regions": 1,
    "events": 1,
    "refreshes": 2,
    "lsn": 19,
    "compression": 0,
    "encryption": 0
  }
}]
files 00000000-0000-0000-0000-000000000000
00000000000000000000
00000000000000000200
00000000000000000700
# test: close/open
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
00000000000000000000
00000000000000000200
00000000000000000700
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 4,
  "events_heap": 0,
  "regions": 1,
  "size": 266,
  "size_uncompressed": 266,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 92,
    "size_regions_origin": 92,
    "size_total": 266,
    "size_total_origin": 266,
    "regions": 1,
    "events": 4,
    "refreshes": 1,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 200,
  "max": 209,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 249,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 75,
    "size_regions_origin": 75,
    "size_total": 249,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 1,
    "lsn": 7,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 700,
  "max": 709,
  "created": "(filtered)",
  "refreshes": 2,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 216,
  "size_uncompressed": 216,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "main",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 42,
    "size_regions_origin": 42,
    "size_total": 216,
    "size_total_origin": 216,
    "regions": 1,
    "events": 1,
    "refreshes": 2,
    "lsn": 19,
    "compression": 0,
    "encryption": 0
  }
}]
select
[0]
[1]
[2]
[3]
[200]
[201]
[202]
[700, x]
(eof)
# test: drop partition
drop partition 0
drop partition 200
drop partition 700
# test: close/open
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show partitions debug
[]
select
(eof)
# test: create storages
create storage hot (sync false)
create storage cold (sync false)
alter pipeline set hot (partitions 2), cold
# test: close/open
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate storages
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "hot": {
    "config": {
      "uuid": "(filtered)",
      "name": "hot",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": false,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "cold": {
    "config": {
      "uuid": "(filtered)",
      "name": "cold",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": false,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  }
}
show pipeline
[{
  "name": "hot",
  "partitions": 2,
  "size": -1,
  "events": -1,
  "duration": -1
}, {
  "name": "cold",
  "partitions": -1,
  "size": -1,
  "events": -1,
  "duration": -1
}]
# test: create partition #1 (< partitions)
insert 0
refresh partition 0
# test: close/open
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 1,
    "compression": 0,
    "encryption": 0
  }
}]
select
[0]
(eof)
# test: create partition #2 (= partitions)
insert 10
refresh partition 10
# test: close/open
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 1,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 10,
  "max": 19,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 2,
    "compression": 0,
    "encryption": 0
  }
}]
select
[0]
[10]
(eof)
# test: create partition #3 (> partitions)
insert 20
refresh partition 20
# test: rebalance
rebalance
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 2,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "cold",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 2,
    "lsn": 1,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 10,
  "max": 19,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 2,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 20,
  "max": 29,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 3,
    "compression": 0,
    "encryption": 0
  }
}]
# test: close/open
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 2,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "cold",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 2,
    "lsn": 1,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 10,
  "max": 19,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 2,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 20,
  "max": 29,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 3,
    "compression": 0,
    "encryption": 0
  }
}]
select
[0]
[10]
[20]
(eof)
# test: delete/refresh
delete 0
refresh partition 0
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 3,
  "events": 0,
  "events_heap": 0,
  "regions": 0,
  "size": 122,
  "size_uncompressed": 122,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "cold",
  "index": {
    "size": 0,
    "size_origin": 0,
    "size_regions": 0,
    "size_regions_origin": 0,
    "size_total": 122,
    "size_total_origin": 122,
    "regions": 0,
    "events": 0,
    "refreshes": 3,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 10,
  "max": 19,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 2,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 20,
  "max": 29,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 3,
    "compression": 0,
    "encryption": 0
  }
}]
# test: close/open (recover empty partition)
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 3,
  "events": 0,
  "events_heap": 0,
  "regions": 0,
  "size": 122,
  "size_uncompressed": 122,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "cold",
  "index": {
    "size": 0,
    "size_origin": 0,
    "size_regions": 0,
    "size_regions_origin": 0,
    "size_total": 122,
    "size_total_origin": 122,
    "regions": 0,
    "events": 0,
    "refreshes": 3,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 10,
  "max": 19,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 2,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 20,
  "max": 29,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 3,
    "compression": 0,
    "encryption": 0
  }
}]
select
[10]
[20]
(eof)
# test: create encrypted storage
create storage test (encryption 'aes')
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "hot": {
    "config": {
      "uuid": "(filtered)",
      "name": "hot",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": false,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 10,
      "max": 29,
      "partitions": 2,
      "partitions_local": 2,
      "partitions_cloud": 0,
      "regions": 2,
      "events": 2,
      "events_heap": 0,
      "size": 430,
      "size_uncompressed": 430,
      "size_heap": 0
    }
  },
  "cold": {
    "config": {
      "uuid": "(filtered)",
      "name": "cold",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": false,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 0,
      "max": 9,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 122,
      "size_uncompressed": 122,
      "size_heap": 0
    }
  },
  "test": {
    "config": {
      "uuid": "(filtered)",
      "name": "test",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": "aes"
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  }
}
move partition 20 into test
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 3,
  "events": 0,
  "events_heap": 0,
  "regions": 0,
  "size": 122,
  "size_uncompressed": 122,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "cold",
  "index": {
    "size": 0,
    "size_origin": 0,
    "size_regions": 0,
    "size_regions_origin": 0,
    "size_total": 122,
    "size_total_origin": 122,
    "regions": 0,
    "events": 0,
    "refreshes": 3,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 10,
  "max": 19,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 2,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 20,
  "max": 29,
  "created": "(filtered)",
  "refreshes": 2,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 279,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "test",
  "index": {
    "size": 84,
    "size_origin": 52,
    "size_regions": 73,
    "size_regions_origin": 41,
    "size_total": 279,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 2,
    "lsn": 3,
    "compression": 0,
    "encryption": 1
  }
}]
insert 21
insert 22
refresh partition 20
# test: close/open (recover encrypted partition)
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "hot": {
    "config": {
      "uuid": "(filtered)",
      "name": "hot",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": false,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 10,
      "max": 19,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 1,
      "events": 1,
      "events_heap": 0,
      "size": 215,
      "size_uncompressed": 215,
      "size_heap": 0
    }
  },
  "cold": {
    "config": {
      "uuid": "(filtered)",
      "name": "cold",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": false,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 0,
      "max": 9,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 122,
      "size_uncompressed": 122,
      "size_heap": 0
    }
  },
  "test": {
    "config": {
      "uuid": "(filtered)",
      "name": "test",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": "aes"
    },
    "stats": {
      "min": 20,
      "max": 29,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 1,
      "events": 3,
      "events_heap": 0,
      "size": 313,
      "size_uncompressed": 249,
      "size_heap": 0
    }
  }
}
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 3,
  "events": 0,
  "events_heap": 0,
  "regions": 0,
  "size": 122,
  "size_uncompressed": 122,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "cold",
  "index": {
    "size": 0,
    "size_origin": 0,
    "size_regions": 0,
    "size_regions_origin": 0,
    "size_total": 122,
    "size_total_origin": 122,
    "regions": 0,
    "events": 0,
    "refreshes": 3,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 10,
  "max": 19,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 2,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 20,
  "max": 29,
  "created": "(filtered)",
  "refreshes": 3,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 313,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "test",
  "index": {
    "size": 84,
    "size_origin": 52,
    "size_regions": 107,
    "size_regions_origin": 75,
    "size_total": 313,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 3,
    "lsn": 6,
    "compression": 0,
    "encryption": 1
  }
}]
select
[10]
[20]
[21]
[22]
(eof)
# test: set compression with encryption
alter storage test set (compression 'zstd')
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "hot": {
    "config": {
      "uuid": "(filtered)",
      "name": "hot",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": false,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 10,
      "max": 19,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 1,
      "events": 1,
      "events_heap": 0,
      "size": 215,
      "size_uncompressed": 215,
      "size_heap": 0
    }
  },
  "cold": {
    "config": {
      "uuid": "(filtered)",
      "name": "cold",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": false,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 0,
      "max": 9,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 122,
      "size_uncompressed": 122,
      "size_heap": 0
    }
  },
  "test": {
    "config": {
      "uuid": "(filtered)",
      "name": "test",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "zstd",
      "compression_level": 0,
      "encryption": "aes"
    },
    "stats": {
      "min": 20,
      "max": 29,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 1,
      "events": 3,
      "events_heap": 0,
      "size": 313,
      "size_uncompressed": 249,
      "size_heap": 0
    }
  }
}
refresh partition 20
# test: close/open (recover encrypted and compressed partition)
close
init
set workers to 0
set workers_upload to 0
set interval to 10
set wal to false
open
files 00000000-0000-0000-0000-000000000000
# test: validate partitions
show storages debug
{
  "main": {
    "config": {
      "uuid": "(filtered)",
      "name": "main",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": -1,
      "max": 0,
      "partitions": 0,
      "partitions_local": 0,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 0,
      "size_uncompressed": 0,
      "size_heap": 0
    }
  },
  "hot": {
    "config": {
      "uuid": "(filtered)",
      "name": "hot",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": false,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 10,
      "max": 19,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 1,
      "events": 1,
      "events_heap": 0,
      "size": 215,
      "size_uncompressed": 215,
      "size_heap": 0
    }
  },
  "cold": {
    "config": {
      "uuid": "(filtered)",
      "name": "cold",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": false,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "",
      "compression_level": 0,
      "encryption": ""
    },
    "stats": {
      "min": 0,
      "max": 9,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 0,
      "events": 0,
      "events_heap": 0,
      "size": 122,
      "size_uncompressed": 122,
      "size_heap": 0
    }
  },
  "test": {
    "config": {
      "uuid": "(filtered)",
      "name": "test",
      "path": "",
      "cloud": "",
      "cloud_drop_local": true,
      "sync": true,
      "crc": false,
      "refresh_wm": 41943040,
      "region_size": 131072,
      "compression": "zstd",
      "compression_level": 0,
      "encryption": "aes"
    },
    "stats": {
      "min": 20,
      "max": 29,
      "partitions": 1,
      "partitions_local": 1,
      "partitions_cloud": 0,
      "regions": 1,
      "events": 3,
      "events_heap": 0,
      "size": 260,
      "size_uncompressed": 249,
      "size_heap": 0
    }
  }
}
show partitions debug
[{
  "min": 0,
  "max": 9,
  "created": "(filtered)",
  "refreshes": 3,
  "events": 0,
  "events_heap": 0,
  "regions": 0,
  "size": 122,
  "size_uncompressed": 122,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "cold",
  "index": {
    "size": 0,
    "size_origin": 0,
    "size_regions": 0,
    "size_regions_origin": 0,
    "size_total": 122,
    "size_total_origin": 122,
    "regions": 0,
    "events": 0,
    "refreshes": 3,
    "lsn": 4,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 10,
  "max": 19,
  "created": "(filtered)",
  "refreshes": 1,
  "events": 1,
  "events_heap": 0,
  "regions": 1,
  "size": 215,
  "size_uncompressed": 215,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "hot",
  "index": {
    "size": 52,
    "size_origin": 52,
    "size_regions": 41,
    "size_regions_origin": 41,
    "size_total": 215,
    "size_total_origin": 215,
    "regions": 1,
    "events": 1,
    "refreshes": 1,
    "lsn": 2,
    "compression": 0,
    "encryption": 0
  }
}, {
  "min": 20,
  "max": 29,
  "created": "(filtered)",
  "refreshes": 4,
  "events": 3,
  "events_heap": 0,
  "regions": 1,
  "size": 260,
  "size_uncompressed": 249,
  "size_heap": 0,
  "on_storage": true,
  "on_cloud": false,
  "storage": "test",
  "index": {
    "size": 67,
    "size_origin": 52,
    "size_regions": 71,
    "size_regions_origin": 75,
    "size_total": 260,
    "size_total_origin": 249,
    "regions": 1,
    "events": 3,
    "refreshes": 4,
    "lsn": 6,
    "compression": 1,
    "encryption": 1
  }
}]
select
[10]
[20]
[21]
[22]
(eof)
close
